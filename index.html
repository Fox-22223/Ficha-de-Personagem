<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Envio de Ficha - RPG</title>
  <link rel="stylesheet" href="style.css" /> <!-- Certifique-se de que style.css está no mesmo diretório -->
</head>
<body>
  <header>
    <h1>Envio de Ficha de Personagem</h1>
  </header>

  <section class="form-container">
    <form id="fichaForm" enctype="multipart/form-data">
      <div class="form-group">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" required />
      </div>

      <div class="form-group">
        <label for="raca">Raça:</label>
        <input type="text" id="raca" name="raca" required />
      </div>

      <div class="form-group">
        <label for="idade">Idade (aparente/real):</label>
        <input type="text" id="idade" name="idade" required />
      </div>

      <div class="form-group">
        <label for="historia">História (resumo):</label>
        <textarea id="historia" name="historia" rows="5" required></textarea>
      </div>

      <div class="form-group">
        <label for="poderes">Poderes:</label>
        <textarea id="poderes" name="poderes" rows="3" required></textarea>
      </div>

      <div class="form-group">
        <label for="fraquezas">Fraquezas:</label>
        <textarea id="fraquezas" name="fraquezas" rows="3" required></textarea>
      </div>

      <div class="form-group">
        <label for="extras">Extras (OFF):</label>
        <textarea id="extras" name="extras" rows="3"></textarea>
      </div>

      <div class="form-group">
        <label for="aparencia">Imagem de Aparência:</label>
        <input type="file" id="aparencia" name="aparencia" accept="image/*" required />
      </div>

      <button type="submit">Enviar Ficha</button>
    </form>
  </section>

  <footer>
    <p>&copy; 2025 Ficha Sombria</p>
  </footer>

  <script>
    const webhookURL = 'http://localhost:3000/ficha'; // Mude para a URL real do seu backend

    document.getElementById('fichaForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(e.target);
      const file = formData.get('aparencia');

      const imgurUploadResponse = await uploadToImgur(file);
      const imgurLink = imgurUploadResponse?.data?.link;

      if (!imgurLink) {
        alert('❌ Falha no upload da imagem.');
        return;
      }

      const data = {
        nome: formData.get('nome'),
        raca: formData.get('raca'),
        idade: formData.get('idade'),
        historia: formData.get('historia'),
        poderes: formData.get('poderes'),
        fraquezas: formData.get('fraquezas'),
        extras: formData.get('extras'),
        imagemUrl: imgurLink
      };

      try {
        await fetch(webhookURL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });

        alert('✅ Ficha enviada com sucesso!');
        e.target.reset();
      } catch (err) {
        alert('❌ Erro ao enviar a ficha.');
        console.error(err);
      }
    });

    async function uploadToImgur(file) {
      const formData = new FormData();
      formData.append('image', file);

      const response = await fetch('https://api.imgur.com/3/image', {
        method: 'POST',
        headers: {
          'Authorization': 'Client-ID 20907a449c20808' // Substitua pela sua real Client-ID
        },
        body: formData
      });

      return await response.json();
    }
  </script>
</body>
</html>

