<form id="fichaForm">
  <div class="form-group">
    <label for="nome">Nome:</label>
    <input type="text" id="nome" name="nome" required />
  </div>

  <div class="form-group">
    <label for="raca">Ra√ßa:</label>
    <input type="text" id="raca" name="raca" required />
  </div>

  <div class="form-group">
    <label for="idade">Idade (aparente/real):</label>
    <input type="text" id="idade" name="idade" required />
  </div>

  <div class="form-group">
    <label>Apar√™ncia (Carregue a imagem):</label>
    <label class="upload-label" for="aparencia">üìÅ Adicionar Imagem</label>
    <input type="file" id="aparencia" name="aparencia" accept="image/*" required />
  </div>

  <div class="form-group">
    <label for="historia">Hist√≥ria (Resumo):</label>
    <textarea id="historia" name="historia"></textarea>
  </div>

  <div class="form-group">
    <label for="poderes">Poderes:</label>
    <textarea id="poderes" name="poderes"></textarea>
  </div>

  <div class="form-group">
    <label for="fraquezas">Fraquezas:</label>
    <textarea id="fraquezas" name="fraquezas"></textarea>
  </div>

  <div class="form-group">
    <label for="extras">Extras (OFF):</label>
    <textarea id="extras" name="extras"></textarea>
  </div>

  <button type="submit">Enviar Ficha</button>
</form>

<script>
  const webhookURL = 'http://localhost:3000/ficha';  // Certifique-se de alterar para o seu servidor

  document.getElementById('fichaForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const file = formData.get('aparencia');

    const imgurUploadResponse = await uploadToImgur(file);
    const imgurLink = imgurUploadResponse?.data?.link;

    if (!imgurLink) {
      alert('Falha no upload da imagem.');
      return;
    }

    const nome = formData.get('nome');
    const raca = formData.get('raca');
    const idade = formData.get('idade');
    const historia = formData.get('historia');
    const poderes = formData.get('poderes');
    const fraquezas = formData.get('fraquezas');
    const extras = formData.get('extras');

    const data = {
      nome,
      raca,
      idade,
      historia,
      poderes,
      fraquezas,
      extras,
      imagemUrl: imgurLink
    };

    // Enviar os dados via fetch
    await fetch(webhookURL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });

    alert('Ficha enviada com sucesso!');
    e.target.reset();
  });

  async function uploadToImgur(file) {
    const formData = new FormData();
    formData.append('image', file);

    const response = await fetch('https://api.imgur.com/3/image', {
      method: 'POST',
      headers: {
        'Authorization': 'Client-ID 20907a449c20808'  // Sua chave do Imgur
      },
      body: formData
    });

    return await response.json();
  }
</script>
